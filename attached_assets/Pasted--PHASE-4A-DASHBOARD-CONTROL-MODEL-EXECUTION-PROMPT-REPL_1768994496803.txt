
üîê PHASE 4A ‚Äî DASHBOARD CONTROL MODEL

EXECUTION PROMPT (REPLIT)

‚∏ª

CONTEXT (READ CAREFULLY)

You are implementing Phase 4A ‚Äî WebWaka Dashboard Control Model.

This is a CORE, HEADLESS, DECLARATIVE CONTROL ENGINE.

It determines WHAT dashboard sections are visible based on:
	‚Ä¢	Permissions
	‚Ä¢	Entitlements
	‚Ä¢	Feature Flags

üö´ This is NOT a UI
üö´ This is NOT a dashboard
üö´ This is NOT role-based
üö´ This is NOT hardcoded logic

This engine will be consumed by:
	‚Ä¢	Super Admin Dashboard
	‚Ä¢	Partner Dashboard
	‚Ä¢	Tenant Dashboard
	‚Ä¢	Suite dashboards (POS, SVM, MVM, etc.)

‚∏ª

REPOSITORY (MANDATORY)

You MUST work in the following repository:

changerplanet/webwaka-core-dashboard-control

CRITICAL RULE

üëâ CLONE THE REPOSITORY FIRST
	‚Ä¢	Do NOT scaffold a new project
	‚Ä¢	Do NOT add placeholder files
	‚Ä¢	Do NOT generate templates

If the repo is empty:
	‚Ä¢	Clone it as-is
	‚Ä¢	Then implement exactly what is specified below

If the repo is NOT cloned, STOP and clone it first.

‚∏ª

SCOPE (STRICT)

You are building a pure TypeScript library that provides:

‚úî Declarative Dashboard Resolution

‚úî Deterministic Evaluation

‚úî Offline-safe Snapshots

‚úî Explainable Visibility Decisions

‚∏ª

‚ùå OUT OF SCOPE (NON-NEGOTIABLE)
	‚Ä¢	‚ùå No UI
	‚Ä¢	‚ùå No React / Vue / HTML
	‚Ä¢	‚ùå No CSS
	‚Ä¢	‚ùå No dashboards
	‚Ä¢	‚ùå No persistence
	‚Ä¢	‚ùå No API server
	‚Ä¢	‚ùå No Date.now()
	‚Ä¢	‚ùå No random values
	‚Ä¢	‚ùå No role checks
	‚Ä¢	‚ùå No hardcoded permissions

‚∏ª

DOMAIN MODELS (ZOD-VALIDATED)

You MUST implement:

1Ô∏è‚É£ DashboardDeclaration

id
sections: DashboardSection[]

2Ô∏è‚É£ DashboardSection

id
label
requires?: {
  permissions?: string[]
  entitlements?: string[]
  featureFlags?: string[]
}

3Ô∏è‚É£ DashboardContext

subjectId
tenantId
evaluationTime
permissions
entitlements
featureFlags

4Ô∏è‚É£ ResolvedDashboard

visibleSections
hiddenSections (with reasons)

5Ô∏è‚É£ DashboardSnapshot

snapshotId
resolvedDashboard
checksum
expiresAt


‚∏ª

CORE ENGINE APIs (MANDATORY)

1Ô∏è‚É£ resolveDashboard()

resolveDashboard(
  declaration: DashboardDeclaration,
  context: DashboardContext
): ResolvedDashboard

Rules:
	‚Ä¢	A section is visible ONLY if ALL required conditions pass
	‚Ä¢	Missing permission OR entitlement OR feature flag ‚Üí hidden
	‚Ä¢	Each hidden section MUST include a reason

‚∏ª

2Ô∏è‚É£ generateDashboardSnapshot()

generateDashboardSnapshot(
  resolved: ResolvedDashboard,
  expirationHours: number
): DashboardSnapshot

Rules:
	‚Ä¢	SHA-256 checksum
	‚Ä¢	Deterministic snapshotId
	‚Ä¢	No system time (use context.evaluationTime)

‚∏ª

3Ô∏è‚É£ verifyDashboardSnapshot()

verifyDashboardSnapshot(snapshot: DashboardSnapshot): boolean

Rules:
	‚Ä¢	Detect tampering
	‚Ä¢	Detect expiration
	‚Ä¢	Fail closed

‚∏ª

4Ô∏è‚É£ evaluateFromSnapshot()

evaluateFromSnapshot(
  snapshot: DashboardSnapshot
): ResolvedDashboard | null

Rules:
	‚Ä¢	Only returns data if snapshot is valid
	‚Ä¢	Otherwise returns null

‚∏ª

INVARIANTS (MUST BE PROVEN BY TESTS)

1Ô∏è‚É£ Determinism
‚Üí Same inputs √ó10 = identical output

2Ô∏è‚É£ Explainability
‚Üí Every hidden section has a reason

3Ô∏è‚É£ Tenant Isolation
‚Üí Cross-tenant context throws error

4Ô∏è‚É£ No Role Logic
‚Üí No role strings anywhere

5Ô∏è‚É£ Snapshot Integrity
‚Üí Any mutation fails verification

‚∏ª

TEST REQUIREMENTS
	‚Ä¢	‚â• 80% coverage
	‚Ä¢	Tests MUST include:
	‚Ä¢	Permission gating
	‚Ä¢	Entitlement gating
	‚Ä¢	Feature flag gating
	‚Ä¢	Mixed failure reasons
	‚Ä¢	Snapshot tampering detection
	‚Ä¢	Offline parity (live vs snapshot)

‚∏ª

CI / BUILD RULES
	‚Ä¢	npm test MUST fail on test failure
	‚Ä¢	npm run build MUST pass
	‚Ä¢	No masked commands (|| true forbidden)

‚∏ª

DELIVERABLE

When complete, provide:

1Ô∏è‚É£ Completion Summary
2Ô∏è‚É£ Test count + coverage
3Ô∏è‚É£ Hard-Stop Proof Statement
4Ô∏è‚É£ Final commit SHA

‚∏ª

‚õî HARD STOP

After completion:

‚õî STOP
‚õî Do NOT proceed to Phase 4B
‚õî Await explicit authorization

‚∏ª

ACKNOWLEDGEMENT FORMAT (REQUIRED)

Reply ONLY with:

‚ÄúPhase 4A acknowledged. Cloning repo and proceeding exactly as instructed.‚Äù

Then execute.

‚∏ª