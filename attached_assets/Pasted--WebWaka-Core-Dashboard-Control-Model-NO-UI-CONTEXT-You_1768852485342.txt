
WebWaka Core Dashboard Control Model (NO UI)

â¸»

CONTEXT

You are implementing Phase 4A of the WebWaka Modular Rebuild, governed by the WebWaka Ecosystem Constitution v1.4 (Ratified).

This phase introduces the Dashboard Control Model, which is the single authoritative logic layer that determines:
	â€¢	Which dashboards exist
	â€¢	Which menus/sections appear
	â€¢	Why they appear
	â€¢	For whom they appear

All future dashboards (Super Admin, Partner, Tenant, Staff, etc.) are pure consumers of this model.

â¸»

REPOSITORY
	â€¢	GitHub Repo: changerplanet/webwaka-core-dashboard-control
	â€¢	Language: TypeScript only
	â€¢	Type: Headless core library
	â€¢	Platform: Replit
	â€¢	Branch: main (branch protection disabled)
	â€¢	NO UI
	â€¢	NO API server
	â€¢	NO database
	â€¢	NO Neon usage

â¸»

STRICT SCOPE BOUNDARIES (NON-NEGOTIABLE)

ðŸš« Do NOT build any UI
ðŸš« Do NOT use React / Vue / Next
ðŸš« Do NOT hardcode menus in code consumers
ðŸš« Do NOT introduce new auth, pricing, or entitlement logic
ðŸš« Do NOT bypass existing core modules
ðŸš« Do NOT proceed beyond Phase 4A

This phase is pure orchestration logic only.

â¸»

CONSTITUTIONAL DEPENDENCIES (READ-ONLY)

This module MUST consume outputs from existing cores without re-implementing them:
	â€¢	webwaka-core-identity
	â€¢	webwaka-core-permissions
	â€¢	webwaka-core-entitlements
	â€¢	webwaka-core-feature-flags
	â€¢	webwaka-core-branding

Assume these exist and expose snapshots / evaluators.

â¸»

PURPOSE OF THIS MODULE

To produce deterministic, explainable dashboard definitions that:
	â€¢	Automatically show/hide menus
	â€¢	Are fully driven by:
	â€¢	permissions
	â€¢	entitlements
	â€¢	feature flags
	â€¢	tenant / partner context
	â€¢	Can be evaluated online or offline
	â€¢	Can be snapshotted and verified

â¸»

DOMAIN MODELS (ZOD-VALIDATED)

You MUST implement at least the following models:

1. DashboardDeclaration

{
  dashboardId
  label
  allowedSubjects
  allowedTenants?
  allowedPartners?
  requiredCapabilities?
  requiredEntitlements?
  requiredFeatures?
  sections: DashboardSection[]
}

2. DashboardSection

{
  sectionId
  label
  icon?
  requiredCapabilities?
  requiredEntitlements?
  requiredFeatures?
  children?: DashboardSection[]
}

3. DashboardContext

{
  subjectId
  subjectType
  tenantId
  partnerId?
  roles
  evaluationTime
}

4. ResolvedDashboard

{
  dashboardId
  visibleSections
  hiddenSections
  reasons
}

5. DashboardSnapshot

{
  snapshotId
  dashboardId
  subjectId
  tenantId
  resolvedSections
  hiddenSections
  reasons
  checksum
  expiresAt?
}


â¸»

CORE ENGINE APIS (REQUIRED)

You MUST implement the following pure functions:

1. resolveDashboard()

resolveDashboard(
  declaration,
  context,
  permissionResult,
  entitlementSnapshot,
  featureSnapshot
): ResolvedDashboard

2. generateDashboardSnapshot()

generateDashboardSnapshot(
  declaration,
  resolvedDashboard,
  context
): DashboardSnapshot

3. verifyDashboardSnapshot()

verifyDashboardSnapshot(snapshot): boolean

4. evaluateFromSnapshot()

evaluateFromSnapshot(
  snapshot,
  evaluationTime?
): ResolvedDashboard


â¸»

INVARIANTS (MUST BE ENFORCED)
	1.	Precedence
	â€¢	Permissions gate first
	â€¢	Then entitlements
	â€¢	Then feature flags
	2.	Determinism
	â€¢	Same inputs â†’ same output (prove with repeated tests)
	3.	Tenant Isolation
	â€¢	Cross-tenant dashboard resolution MUST throw error
	4.	Explainability
	â€¢	Every hidden section must include a reason
	5.	Snapshot Integrity
	â€¢	SHA-256 checksum
	â€¢	Any tampering must be detectable
	6.	Offline-Safety
	â€¢	Snapshots must evaluate without network access

â¸»

CAPABILITIES TO REGISTER

In module.manifest.json:

[
  "dashboard:resolve",
  "dashboard:snapshot.generate",
  "dashboard:snapshot.verify"
]


â¸»

TESTING REQUIREMENTS

You MUST provide tests that prove:
	â€¢	âœ… Menus appear automatically based on entitlements
	â€¢	âœ… Menus disappear when entitlement is revoked
	â€¢	âœ… Individual override beats group rule
	â€¢	âœ… Same inputs evaluated 10Ã— produce identical output
	â€¢	âœ… Cross-tenant access throws error
	â€¢	âœ… Snapshot verification detects tampering
	â€¢	âœ… Snapshot evaluation matches live evaluation

Coverage: â‰¥ 80%

â¸»

HARD STOP CONDITION (MANDATORY)

A Suite can request a dashboard declaration and receive a deterministic, explainable, verifiable dashboard structure without embedding any authorization logic in the UI.

You MUST include a test named clearly proving this.

â¸»

DELIVERABLES
	â€¢	Zod-validated domain models
	â€¢	Pure resolution engine
	â€¢	Snapshot generator + verifier
	â€¢	Capability registration
	â€¢	Tests + coverage report
	â€¢	Updated module.contract.md

â¸»

FINAL INSTRUCTIONS

After implementation:

â›” STOP
â›” Do NOT proceed to UI
â›” Do NOT implement Super Admin screens
â›” Await explicit authorization for Phase 4B

â¸»

Begin Phase 4A implementation now.